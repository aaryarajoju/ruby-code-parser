<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Principles Analysis - PR #2933</title>
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --text-primary: #c9d1d9;
      --text-secondary: #8b949e;
      --accent-blue: #58a6ff;
      --accent-green: #3fb950;
      --accent-yellow: #d29922;
      --accent-red: #f85149;
      --accent-purple: #a371f7;
      --border-color: #30363d;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 2rem;
    }
    
    .container { max-width: 1200px; margin: 0 auto; }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.5rem;
    }
    
    h2 {
      font-size: 1.4rem;
      margin: 2rem 0 1rem;
      color: var(--accent-blue);
    }
    
    h3 {
      font-size: 1.1rem;
      margin: 1.5rem 0 0.75rem;
      color: var(--text-primary);
    }
    
    .pr-info {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .pr-info a {
      color: var(--accent-blue);
      text-decoration: none;
    }
    
    .pr-info a:hover { text-decoration: underline; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
    }
    
    .stat-card .value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--accent-blue);
    }
    
    .stat-card .label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }
    
    .stat-card.warning .value { color: var(--accent-yellow); }
    .stat-card.danger .value { color: var(--accent-red); }
    .stat-card.success .value { color: var(--accent-green); }
    
    .file-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      margin: 1rem 0;
      overflow: hidden;
    }
    
    .file-header {
      background: var(--bg-tertiary);
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .file-name { font-family: monospace; font-weight: bold; }
    
    .badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge-added { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
    .badge-modified { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
    .badge-removed { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
    
    .violation {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
    }
    
    .violation:last-child { border-bottom: none; }
    
    .violation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .violation-type {
      font-weight: bold;
      color: var(--accent-purple);
    }
    
    .confidence {
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .confidence-high { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
    .confidence-medium { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
    .confidence-low { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
    
    .violation-meta {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }
    
    .violation-reason { margin: 0.75rem 0; }
    
    .code-block {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 0.75rem;
      font-family: monospace;
      font-size: 0.85rem;
      overflow-x: auto;
      white-space: pre-wrap;
      margin-top: 0.75rem;
    }
    
    .changed-indicator {
      background: rgba(88, 166, 255, 0.2);
      color: var(--accent-blue);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-left: 0.5rem;
    }
    
    .no-violations {
      padding: 1rem;
      color: var(--accent-green);
      text-align: center;
    }
    
    .suggestion {
      background: rgba(163, 113, 247, 0.1);
      border-left: 3px solid var(--accent-purple);
      padding: 0.75rem;
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }
    
    footer {
      margin-top: 3rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Design Principles Analysis Report</h1>
    
    <div class="pr-info">
      <h2 style="margin-top: 0;">Pull Request #2933</h2>
      <p><strong>E2500 refactor student teams functionality</strong></p>
      <p>
        <strong>Repository:</strong> expertiza/expertiza |
        <strong>Author:</strong> sweekar52 |
        <strong>State:</strong> open
        
      </p>
      <p><a href="https://github.com/expertiza/expertiza/pull/2933" target="_blank">View on GitHub â†’</a></p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="value">97</div>
        <div class="label">Files Analyzed</div>
      </div>
      <div class="stat-card danger">
        <div class="value">149</div>
        <div class="label">Total Violations</div>
      </div>
      <div class="stat-card warning">
        <div class="value">149</div>
        <div class="label">In Changed Code</div>
      </div>
      <div class="stat-card danger">
        <div class="value">144</div>
        <div class="label">High Severity</div>
      </div>
    </div>
    
    
    <h2>Violations by Principle</h2>
    <div class="stats-grid">
      
      <div class="stat-card">
        <div class="value">95</div>
        <div class="label">Information Expert</div>
      </div>
      
      <div class="stat-card">
        <div class="value">30</div>
        <div class="label">Law of Demeter</div>
      </div>
      
      <div class="stat-card">
        <div class="value">7</div>
        <div class="label">Single Responsibility Principle</div>
      </div>
      
      <div class="stat-card">
        <div class="value">6</div>
        <div class="label">Encapsulation</div>
      </div>
      
      <div class="stat-card">
        <div class="value">4</div>
        <div class="label">Dependency Inversion Principle</div>
      </div>
      
      <div class="stat-card">
        <div class="value">1</div>
        <div class="label">Open/Closed Principle</div>
      </div>
      
      <div class="stat-card">
        <div class="value">6</div>
        <div class="label">Overuse of Class Methods</div>
      </div>
      
    </div>
    
    
    <h2>Detailed Findings</h2>
    
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/assessment360_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-medium">
            75%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Assessment360Controller</code> |
          <strong>Line:</strong> 131
        </div>
        <div class="violation-reason">Method `assignment_grade_summary` manipulates external state 6 times vs 5 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def assignment_grade_summary(cp, assignment_id, penalties)
    user_id = cp.user_id
    # topic exists if a team signed up for a topic, which can be found via the user and the assignment
    topic_id = SignedUpTeam.topic_id(assignment_id, user_id)
    @topics[cp.id][assignment_id] = SignUpTopic.find_by(id: topic_id)
    # instructor grade is stored in the team model, which is found by finding the user&#39;s team for the assignment</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Assessment360Controller</code> |
          <strong>Line:</strong> 145
        </div>
        <div class="violation-reason">Method `insure_existence_of` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def insure_existence_of(course_participants, course)
    if course_participants.empty?
      flash[:error] = &quot;There is no course participant in course #{course.name}&quot;
      redirect_back fallback_location: root_path
    end
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/grades_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>GradesController</code> |
          <strong>Line:</strong> 58
        </div>
        <div class="violation-reason">Method `view_my_scores` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def view_my_scores
    @participant = AssignmentParticipant.find(params[:id])
    @team_id = TeamsParticipant.team_id(@participant.parent_id, @participant.user_id)
    return if redirect_when_disallowed

    @assignment = @participant.assignment</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/invitations_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-medium">
            75%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>InvitationsController</code> |
          <strong>Line:</strong> 141
        </div>
        <div class="violation-reason">Method `check_team_before_accept` manipulates external state 4 times vs 3 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def check_team_before_accept
    @inv = Invitation.find(params[:inv_id])
    # check if the inviter&#39;s team is still existing, and have available slot to add the invitee
    inviter_assignment_team = AssignmentTeam.team(AssignmentParticipant.find_by(user_id: @inv.from_id, parent_id: @inv.assignment_id))
    if inviter_assignment_team.nil?
      flash[:error] = &#39;The team that invited you does not exist anymore.&#39;</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/join_team_requests_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>JoinTeamRequestsController</code> |
          <strong>Line:</strong> 90
        </div>
        <div class="violation-reason">Method `check_team_status` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def check_team_status
    # check if the advertisement is from a team member and if so disallow requesting invitations
    team_member = TeamsParticipant.where([&#39;team_id =? and user_id =?&#39;, params[:team_id], session[:user][:id]])
    team = Team.find(params[:team_id])
    return flash[:error] = &#39;This team is full.&#39; if team.full?
    return flash[:error] = &#39;You are already a member of this team.&#39; unless team_member.empty?</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>JoinTeamRequestsController</code> |
          <strong>Line:</strong> 102
        </div>
        <div class="violation-reason">Method `respond_after` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def respond_after(request)
    respond_to do |format|
      format.html
      format.xml { render xml: request }
    end
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/lottery_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>LotteryController</code> |
          <strong>Line:</strong> 85
        </div>
        <div class="violation-reason">Method `create_new_teams_for_bidding_response` manipulates external state 8 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def create_new_teams_for_bidding_response(teams, assignment, users_bidding_info)
    teams.each do |user_ids|
      if assignment.auto_assign_mentor
        new_team = MentoredTeam.create_team_with_users(assignment.id, user_ids)
      else
        new_team = AssignmentTeam.create_team_with_users(assignment.id, user_ids)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/pair_programming_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PairProgrammingController</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 4 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class PairProgrammingController &lt; ApplicationController
  include AuthorizationHelper

  def action_allowed?
    current_user_has_student_privileges?
  end

  def send_invitations</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PairProgrammingController</code> |
          <strong>Line:</strong> 8
        </div>
        <div class="violation-reason">Method `send_invitations` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def send_invitations
    users = TeamsParticipant.where(team_id: params[:team_id])
    users.each { |user| user.update_attributes(pair_programming_status: &quot;W&quot;) }
    TeamsParticipant.find_by(team_id: params[:team_id], user_id: current_user.id).update_attributes(pair_programming_status: &quot;A&quot;)
    # ExpertizaLogger.info &quot;Accepting Invitation #{params[:inv_id]}: #{accepted}&quot;
    Team.find(params[:team_id]).update_attributes(pair_programming_request: 1)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PairProgrammingController</code> |
          <strong>Line:</strong> 18
        </div>
        <div class="violation-reason">Method `accept` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def accept
    user = TeamsParticipant.find_by(team_id: params[:team_id], user_id: current_user.id)
    user.update_attributes(pair_programming_status: &quot;A&quot;)
    flash[:success] = &quot;Pair Programming Request Accepted Successfully!&quot;
    redirect_to view_student_teams_path student_id: params[:student_id]
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PairProgrammingController</code> |
          <strong>Line:</strong> 25
        </div>
        <div class="violation-reason">Method `decline` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def decline
    user = TeamsParticipant.find_by(team_id: params[:team_id], user_id: current_user.id)
    user.update_attributes(pair_programming_status: &quot;D&quot;)
    Team.find(params[:team_id]).update_attributes(pair_programming_request: 0)
    flash[:success] = &quot;Pair Programming Request Declined!&quot;
    redirect_to view_student_teams_path student_id: params[:student_id]</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PairProgrammingController</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class PairProgrammingController &lt; ApplicationController
  include AuthorizationHelper

  def action_allowed?
    current_user_has_student_privileges?
  end

  def send_invitations</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/participants_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ParticipantsController</code> |
          <strong>Line:</strong> 205
        </div>
        <div class="violation-reason">Method `get_user_info` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_user_info(team_participant, assignment)
    user = {}
    user[:name] = team_participant.name
    user[:fullname] = team_participant.fullname
    # set by default
    permission_granted = false</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ParticipantsController</code> |
          <strong>Line:</strong> 221
        </div>
        <div class="violation-reason">Method `get_signup_topics_for_assignment` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_signup_topics_for_assignment(assignment_id, team_info, team_id)
    signup_topics = SignUpTopic.where(&#39;assignment_id = ?&#39;, assignment_id)
    if signup_topics.any?
      has_topics = true
      signup_topics.each do |signup_topic|
        signup_topic.signed_up_teams.each do |signed_up_team|</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ParticipantsController</code> |
          <strong>Line:</strong> 205
        </div>
        <div class="violation-reason">Method `get_user_info` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_user_info(team_participant, assignment)
    user = {}
    user[:name] = team_participant.name
    user[:fullname] = team_participant.fullname
    # set by default
    permission_granted = false</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ParticipantsController</code> |
          <strong>Line:</strong> 221
        </div>
        <div class="violation-reason">Method `get_signup_topics_for_assignment` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_signup_topics_for_assignment(assignment_id, team_info, team_id)
    signup_topics = SignUpTopic.where(&#39;assignment_id = ?&#39;, assignment_id)
    if signup_topics.any?
      has_topics = true
      signup_topics.each do |signup_topic|
        signup_topic.signed_up_teams.each do |signed_up_team|</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/popup_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>PopupController</code> |
          <strong>Line:</strong> 35
        </div>
        <div class="violation-reason">Method `team_participants_popup` manipulates external state 25 times vs 22 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def team_participants_popup
    @ip = session[:ip]
    @sum = 0
    @team = Team.find(params[:id])
    @assignment = Assignment.find(@team.parent_id)
    @team_participants = TeamsParticipant.where(team_id: params[:id])</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/review_mapping_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+10</span>
          <span style="color: var(--accent-red)">-10</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingController</code> |
          <strong>Line:</strong> 344
        </div>
        <div class="violation-reason">Method `automatic_review_mapping` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def automatic_review_mapping
    assignment_id = params[:id].to_i
    assignment = Assignment.find(params[:id])
    participants = AssignmentParticipant.where(parent_id: params[:id].to_i).to_a.select(&amp;:can_review).shuffle!
    teams = AssignmentTeam.where(parent_id: params[:id].to_i).to_a.shuffle!
    max_team_size = Integer(params[:max_team_size]) # Assignment.find(assignment_id).max_team_size</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingController</code> |
          <strong>Line:</strong> 515
        </div>
        <div class="violation-reason">Method `peer_review_strategy` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def peer_review_strategy(assignment_id, review_strategy, participants_hash)
    teams = review_strategy.teams
    participants = review_strategy.participants
    num_participants = participants.size

    teams.each_with_index do |team, iterator|</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingController</code> |
          <strong>Line:</strong> 54
        </div>
        <div class="violation-reason">Method `add_reviewer` manipulates external state 12 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def add_reviewer
    assignment = Assignment.find(params[:id])
    topic_id = params[:topic_id]
    user_id = User.where(name: params[:user][:name]).first.id
    # If instructor want to assign one student to review his/her own artifact,
    # it should be counted as &quot;self-review&quot; and we need to make /app/views/submitted_content/_selfreview.html.erb work.</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingController</code> |
          <strong>Line:</strong> 344
        </div>
        <div class="violation-reason">Method `automatic_review_mapping` manipulates external state 20 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def automatic_review_mapping
    assignment_id = params[:id].to_i
    assignment = Assignment.find(params[:id])
    participants = AssignmentParticipant.where(parent_id: params[:id].to_i).to_a.select(&amp;:can_review).shuffle!
    teams = AssignmentTeam.where(parent_id: params[:id].to_i).to_a.shuffle!
    max_team_size = Integer(params[:max_team_size]) # Assignment.find(assignment_id).max_team_size</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingController</code> |
          <strong>Line:</strong> 515
        </div>
        <div class="violation-reason">Method `peer_review_strategy` manipulates external state 40 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def peer_review_strategy(assignment_id, review_strategy, participants_hash)
    teams = review_strategy.teams
    participants = review_strategy.participants
    num_participants = participants.size

    teams.each_with_index do |team, iterator|</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/sign_up_sheet_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetController</code> |
          <strong>Line:</strong> 290
        </div>
        <div class="violation-reason">Method `delete_signup_as_instructor` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete_signup_as_instructor
    # find participant using assignment using team and topic ids
    team = Team.find(params[:id])
    assignment = Assignment.find(team.parent_id)
    user = TeamsParticipant.find_by(team_id: team.id).user
    participant = AssignmentParticipant.find_by(user_id: user.id, parent_id: assignment.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetController</code> |
          <strong>Line:</strong> 290
        </div>
        <div class="violation-reason">Method `delete_signup_as_instructor` manipulates external state 13 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete_signup_as_instructor
    # find participant using assignment using team and topic ids
    team = Team.find(params[:id])
    assignment = Assignment.find(team.parent_id)
    user = TeamsParticipant.find_by(team_id: team.id).user
    participant = AssignmentParticipant.find_by(user_id: user.id, parent_id: assignment.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetController</code> |
          <strong>Line:</strong> 424
        </div>
        <div class="violation-reason">Method `switch_original_topic_to_approved_suggested_topic` manipulates external state 7 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def switch_original_topic_to_approved_suggested_topic
    assignment = AssignmentParticipant.find(params[:id]).assignment
    team_id = TeamsParticipant.team_id(assignment.id, session[:user].id)

    # Tmp variable to store topic id before change
    original_topic_id = SignedUpTeam.topic_id(assignment.id.to_i, session[:user].id)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/student_teams_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+8</span>
          <span style="color: var(--accent-red)">-8</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>StudentTeamsController</code> |
          <strong>Line:</strong> 122
        </div>
        <div class="violation-reason">Method `remove_participant` manipulates external state 8 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def remove_participant
    # remove the record from teams_participants table
    team_participant = TeamsParticipant.where(team_id: params[:team_id], user_id: student.user_id)
    remove_team_participant(team_participant)
    # if your old team does not have any members, delete the entry for the team
    if TeamsParticipant.where(team_id: params[:team_id]).empty?</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>StudentTeamsController</code> |
          <strong>Line:</strong> 143
        </div>
        <div class="violation-reason">Method `remove_team_participant` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def remove_team_participant(team_participant)
    return false unless team_participant

    team_participant.destroy_all
    undo_link &quot;The user \&quot;#{team_participant.name}\&quot; has been successfully removed from the team.&quot;
    ExpertizaLogger.info LoggerMessage.new(controller_name, session[:user].name, &#39;User removed a participant from the team&#39;, request)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>StudentTeamsController</code> |
          <strong>Line:</strong> 151
        </div>
        <div class="violation-reason">Method `team_created_successfully` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def team_created_successfully(current_team = nil)
    if current_team
      undo_link &quot;The team \&quot;#{current_team.name}\&quot; has been successfully updated.&quot;
    else
      undo_link &quot;The team \&quot;#{team.name}\&quot; has been successfully updated.&quot;
    end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/suggestion_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SuggestionController</code> |
          <strong>Line:</strong> 94
        </div>
        <div class="violation-reason">Method `send_email` manipulates external state 8 times vs 4 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def send_email
    proposer = User.find_by(id: @user_id)
    if proposer
      teams_participants = TeamsParticipant.where(team_id: @team_id)
      cc_mail_list = []
      teams_participants.each do |teams_participant|</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/teams_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsController</code> |
          <strong>Line:</strong> 115
        </div>
        <div class="violation-reason">Method `delete_all` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete_all
    root_node = Object.const_get(session[:team_type] + &#39;Node&#39;).find_by(node_object_id: params[:id])
    child_nodes = root_node.get_teams.map(&amp;:node_object_id)
    Team.destroy_all if child_nodes
    redirect_to action: &#39;list&#39;, id: params[:id]
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsController</code> |
          <strong>Line:</strong> 123
        </div>
        <div class="violation-reason">Method `delete` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete
    # delete records in team, teams_participants, signed_up_teams table
    @team = Team.find_by(id: params[:id])
    unless @team.nil?
      # Find all SignedUpTeam records associated with the found team.
      @signed_up_team = SignedUpTeam.where(team_id: @team.id)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/teams_participants_controller.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+71</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 8 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsParticipantsController &lt; ApplicationController
  before_action :set_team,   only: %i[index new create delete_selected]
  before_action :set_member, only: %i[destroy]

  # GET /teams/:team_id/teams_participants
  def index
    @assignment         = @team.parent
    @teams_participants = @team.teams_participants.includes(participant: :user)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Dependency Inversion Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Directly instantiates 1 concrete collaborators; prefer dependency injection.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsParticipantsController &lt; ApplicationController
  before_action :set_team,   only: %i[index new create delete_selected]
  before_action :set_member, only: %i[destroy]

  # GET /teams/:team_id/teams_participants
  def index
    @assignment         = @team.parent
    @teams_participants = @team.teams_participants.includes(participant: :user)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 6
        </div>
        <div class="violation-reason">Method `index` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def index
    @assignment         = @team.parent
    @teams_participants = @team.teams_participants.includes(participant: :user)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 17
        </div>
        <div class="violation-reason">Method `create` contains a call chain of length 4.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def create
    user = User.find_by(name: join_params[:user_name])
    unless user
      flash.now[:error] = &quot;No user found with name #{join_params[:user_name].inspect}&quot;
      return render :new, status: :unprocessable_entity
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 17
        </div>
        <div class="violation-reason">Method `create` manipulates external state 11 times vs 4 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def create
    user = User.find_by(name: join_params[:user_name])
    unless user
      flash.now[:error] = &quot;No user found with name #{join_params[:user_name].inspect}&quot;
      return render :new, status: :unprocessable_entity
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-medium">
            75%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 51
        </div>
        <div class="violation-reason">Method `delete_selected` manipulates external state 3 times vs 2 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete_selected
    ids     = Array(params[:selected]).map(&amp;:to_i).uniq
    deleted = TeamsParticipant.where(id: ids, team_id: @team.id).destroy_all
    flash[:notice] = &quot;Removed #{deleted.size} #{&#39;member&#39;.pluralize(deleted.size)}.&quot;
    redirect_to team_teams_participants_path(@team)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipantsController</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsParticipantsController &lt; ApplicationController
  before_action :set_team,   only: %i[index new create delete_selected]
  before_action :set_member, only: %i[destroy]

  # GET /teams/:team_id/teams_participants
  def index
    @assignment         = @team.parent
    @teams_participants = @team.teams_participants.includes(participant: :user)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/teams_users_controller.rb</span>
        <span>
          <span class="badge badge-removed">removed</span>
          
          <span style="color: var(--accent-green)">+0</span>
          <span style="color: var(--accent-red)">-112</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/controllers/users_controller.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/assignment_helper.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentHelper</code> |
          <strong>Line:</strong> 78
        </div>
        <div class="violation-reason">Method `get_data_for_list_submissions` manipulates external state 9 times vs 1 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_data_for_list_submissions(team)
    teams_participants = TeamsParticipant.where(team_id: team.id)
    topic = SignedUpTeam.where(team_id: team.id).first.try :topic
    topic_identifier = topic.try :topic_identifier
    topic_name = topic.try :topic_name
    users_for_curr_team = []</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentHelper</code> |
          <strong>Line:</strong> 95
        </div>
        <div class="violation-reason">Method `get_team_name_color_in_list_submission` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_team_name_color_in_list_submission(team)
    if team.try(:grade_for_submission) &amp;&amp; team.try(:comment_for_submission)
      &#39;#cd6133&#39; # brown. submission grade has been assigned.
    else
      &#39;#0984e3&#39; # submission grade is not assigned yet.
    end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/manage_team_helper.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Dependency Inversion Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ManageTeamHelper</code> |
          <strong>Line:</strong> 4
        </div>
        <div class="violation-reason">Directly instantiates 1 concrete collaborators; prefer dependency injection.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">module ManageTeamHelper
  # Adds a user specified by &#39;user&#39; object to a team specified by &#39;team_id&#39;
  def create_team_participants(user, team_id)
    # if user does not exist flash message
    unless user
      urlCreate = url_for controller: &#39;users&#39;, action: &#39;new&#39;
      ExpertizaLogger.error LoggerMessage.new(&#39;ManageTeamHelper&#39;, &#39;&#39;, &#39;User being added to the team does not exist!&#39;, request)
      flash[:error] = &quot;\&quot;#{params[:user][:name].strip}\&quot; is not defined. Please &lt;a href=\&quot;#{urlCreate}\&quot;&gt;create&lt;/a&gt; this user before continuing.&quot;</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ManageTeamHelper</code> |
          <strong>Line:</strong> 6
        </div>
        <div class="violation-reason">Method `create_team_participants` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def create_team_participants(user, team_id)
    # if user does not exist flash message
    unless user
      urlCreate = url_for controller: &#39;users&#39;, action: &#39;new&#39;
      ExpertizaLogger.error LoggerMessage.new(&#39;ManageTeamHelper&#39;, &#39;&#39;, &#39;User being added to the team does not exist!&#39;, request)
      flash[:error] = &quot;\&quot;#{params[:user][:name].strip}\&quot; is not defined. Please &lt;a href=\&quot;#{urlCreate}\&quot;&gt;create&lt;/a&gt; this user before continuing.&quot;</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/review_mapping_helper.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingHelper</code> |
          <strong>Line:</strong> 116
        </div>
        <div class="violation-reason">Method `get_team_reviewed_link_name` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_team_reviewed_link_name(max_team_size, _response, reviewee_id, ip_address)
    team_reviewed_link_name = if max_team_size == 1
                                TeamsParticipant.where(team_id: reviewee_id).first.user.fullname(ip_address)
                              else
                                # E1991 : check anonymized view here
                                Team.find(reviewee_id).name</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingHelper</code> |
          <strong>Line:</strong> 109
        </div>
        <div class="violation-reason">Method `link_updated_since_last?` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def link_updated_since_last?(round, due_dates, link_updated_at)
    submission_due_date = due_dates.where(round: round, deadline_type_id: 1).try(:first).try(:due_at)
    submission_due_last_round = due_dates.where(round: round - 1, deadline_type_id: 1).try(:first).try(:due_at)
    (link_updated_at &lt; submission_due_date) &amp;&amp; (link_updated_at &gt; submission_due_last_round)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingHelper</code> |
          <strong>Line:</strong> 116
        </div>
        <div class="violation-reason">Method `get_team_reviewed_link_name` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_team_reviewed_link_name(max_team_size, _response, reviewee_id, ip_address)
    team_reviewed_link_name = if max_team_size == 1
                                TeamsParticipant.where(team_id: reviewee_id).first.user.fullname(ip_address)
                              else
                                # E1991 : check anonymized view here
                                Team.find(reviewee_id).name</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>ReviewMappingHelper</code> |
          <strong>Line:</strong> 402
        </div>
        <div class="violation-reason">Method `get_css_style_for_calibration_report` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_css_style_for_calibration_report(diff)
    # diff - difference between stu&#39;s answer and instructor&#39;s answer
    dict = { 0 =&gt; &#39;c5&#39;, 1 =&gt; &#39;c4&#39;, 2 =&gt; &#39;c3&#39;, 3 =&gt; &#39;c2&#39; }
    css_class = if dict.key?(diff.abs)
                  dict[diff.abs]
                else</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/sign_up_sheet_helper.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+7</span>
          <span style="color: var(--accent-red)">-7</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetHelper</code> |
          <strong>Line:</strong> 33
        </div>
        <div class="violation-reason">Method `get_intelligent_topic_row` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_intelligent_topic_row(topic, selected_topics, max_team_size = 3)
    row_html = &#39;&#39;
    if selected_topics.present?
      selected_topics.each do |selected_topic|
        row_html = if (selected_topic.topic_id == topic.id) &amp;&amp; !selected_topic.is_waitlisted
                     &#39;&lt;tr bgcolor=&quot;yellow&quot;&gt;&#39;</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetHelper</code> |
          <strong>Line:</strong> 59
        </div>
        <div class="violation-reason">Method `render_participant_info` contains a call chain of length 4.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def render_participant_info(topic, assignment, participants)
    html = &#39;&#39;
    if participants.present?
      chooser_present = false
      participants.each do |participant|
        next unless topic.id == participant.topic_id</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-medium">
            75%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetHelper</code> |
          <strong>Line:</strong> 22
        </div>
        <div class="violation-reason">Method `get_suggested_topics` manipulates external state 2 times vs 1 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_suggested_topics(assignment_id)
    team_id = TeamsParticipant.team_id(assignment_id, session[:user].id)
    teams_participants = TeamsParticipant.where(team_id: team_id)
    teams_participants_array = []
    teams_participants.each do |teams_participant|
      teams_participants_array &lt;&lt; teams_participant.user_id</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetHelper</code> |
          <strong>Line:</strong> 33
        </div>
        <div class="violation-reason">Method `get_intelligent_topic_row` manipulates external state 11 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_intelligent_topic_row(topic, selected_topics, max_team_size = 3)
    row_html = &#39;&#39;
    if selected_topics.present?
      selected_topics.each do |selected_topic|
        row_html = if (selected_topic.topic_id == topic.id) &amp;&amp; !selected_topic.is_waitlisted
                     &#39;&lt;tr bgcolor=&quot;yellow&quot;&gt;&#39;</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheetHelper</code> |
          <strong>Line:</strong> 59
        </div>
        <div class="violation-reason">Method `render_participant_info` manipulates external state 15 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def render_participant_info(topic, assignment, participants)
    html = &#39;&#39;
    if participants.present?
      chooser_present = false
      participants.each do |participant|
        next unless topic.id == participant.topic_id</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/teams_participants_helper.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/helpers/teams_users_helper.rb</span>
        <span>
          <span class="badge badge-removed">removed</span>
          
          <span style="color: var(--accent-green)">+0</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/mailers/mail_worker.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 61
        </div>
        <div class="violation-reason">Method `find_participant_emails` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def find_participant_emails
    emails = []
    participants = Participant.where(parent_id: assignment_id)
    participants.each do |participant|
      emails &lt;&lt; participant.user.email unless participant.user.nil?
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 70
        </div>
        <div class="violation-reason">Method `drop_one_member_topics` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def drop_one_member_topics
    teams = TeamsParticipant.all.group(:team_id).count(:team_id)
    teams.keys.each do |team_id|
      if teams[team_id] == 1
        topic_to_drop = SignedUpTeam.where(team_id: team_id).first
        topic_to_drop.delete if topic_to_drop # check if the one-person-team has signed up a topic</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 80
        </div>
        <div class="violation-reason">Method `drop_outstanding_reviews` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def drop_outstanding_reviews
    reviews = ResponseMap.where(reviewed_object_id: assignment_id)
    reviews.each do |review|
      review_has_began = Response.where(map_id: review.id)
      if review_has_began.size.zero?
        review_to_drop = ResponseMap.where(id: review.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 61
        </div>
        <div class="violation-reason">Method `find_participant_emails` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def find_participant_emails
    emails = []
    participants = Participant.where(parent_id: assignment_id)
    participants.each do |participant|
      emails &lt;&lt; participant.user.email unless participant.user.nil?
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 70
        </div>
        <div class="violation-reason">Method `drop_one_member_topics` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def drop_one_member_topics
    teams = TeamsParticipant.all.group(:team_id).count(:team_id)
    teams.keys.each do |team_id|
      if teams[team_id] == 1
        topic_to_drop = SignedUpTeam.where(team_id: team_id).first
        topic_to_drop.delete if topic_to_drop # check if the one-person-team has signed up a topic</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MailWorker</code> |
          <strong>Line:</strong> 80
        </div>
        <div class="violation-reason">Method `drop_outstanding_reviews` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def drop_outstanding_reviews
    reviews = ResponseMap.where(reviewed_object_id: assignment_id)
    reviews.each do |review|
      review_has_began = Response.where(map_id: review.id)
      if review_has_began.size.zero?
        review_to_drop = ResponseMap.where(id: review.id)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/assignment.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Assignment</code> |
          <strong>Line:</strong> 102
        </div>
        <div class="violation-reason">Method `remove_empty_teams` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def remove_empty_teams
    empty_teams = teams.reload.select { |team| team.teams_participants.empty? }
    teams.delete(empty_teams)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Assignment</code> |
          <strong>Line:</strong> 102
        </div>
        <div class="violation-reason">Method `remove_empty_teams` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def remove_empty_teams
    empty_teams = teams.reload.select { |team| team.teams_participants.empty? }
    teams.delete(empty_teams)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Assignment</code> |
          <strong>Line:</strong> 108
        </div>
        <div class="violation-reason">Method `valid_num_review` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def valid_num_review
    self.num_reviews = num_reviews_allowed
    if num_reviews_greater?(num_reviews_required, num_reviews_allowed)
      errors.add(:message, &#39;Num of reviews required cannot be greater than number of reviews allowed&#39;)
    elsif num_reviews_greater?(num_metareviews_required, num_metareviews_allowed)
      errors.add(:message, &#39;Number of Meta-Reviews required cannot be greater than number of meta-reviews allowed&#39;)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/assignment_participant.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentParticipant</code> |
          <strong>Line:</strong> 171
        </div>
        <div class="violation-reason">Method `review_file_path` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def review_file_path(response_map_id = nil, participant = nil)
    if response_map_id.nil?
      return if participant.nil?

      no_team_path = assignment.path + &#39;/&#39; + participant.name.parameterize(separator: &#39;_&#39;) + &#39;_review&#39;
      return no_team_path if participant.team.nil?</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentParticipant</code> |
          <strong>Line:</strong> 171
        </div>
        <div class="violation-reason">Method `review_file_path` manipulates external state 12 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def review_file_path(response_map_id = nil, participant = nil)
    if response_map_id.nil?
      return if participant.nil?

      no_team_path = assignment.path + &#39;/&#39; + participant.name.parameterize(separator: &#39;_&#39;) + &#39;_review&#39;
      return no_team_path if participant.team.nil?</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/assignment_team.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentTeam</code> |
          <strong>Line:</strong> 212
        </div>
        <div class="violation-reason">Method `team` manipulates external state 8 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.team(participant)
    return nil if participant.nil?

    team = nil
    teams_participants = TeamsParticipant.where(user_id: participant.user_id)
    return nil unless teams_participants</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentTeam</code> |
          <strong>Line:</strong> 230
        </div>
        <div class="violation-reason">Method `export_fields` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.export_fields(options)
    fields = []
    fields.push(&#39;Team Name&#39;)
    fields.push(&#39;Team members&#39;) if options[:team_name] == &#39;false&#39;
    fields.push(&#39;Assignment Name&#39;)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AssignmentTeam</code> |
          <strong>Line:</strong> 283
        </div>
        <div class="violation-reason">Method `create_new_team` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def create_new_team(user_id, signuptopic)
    t_user = TeamsParticipant.create(team_id: id, user_id: user_id)
    SignedUpTeam.create(topic_id: signuptopic.id, team_id: id, is_waitlisted: 0)
    parent = TeamNode.create(parent_id: signuptopic.assignment_id, node_object_id: id)
    TeamUserNode.create(parent_id: parent.id, node_object_id: t_user.id)
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/cake.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Cake</code> |
          <strong>Line:</strong> 116
        </div>
        <div class="violation-reason">Method `calculate_total_score` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def calculate_total_score(question_answers)
    question_score = 0.0
    question_answers.each do |question_answer|
      # calculate score per question
      unless question_answer.answer.nil?
        question_score += question_answer.answer</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Cake</code> |
          <strong>Line:</strong> 96
        </div>
        <div class="violation-reason">Method `get_total_score_for_question` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_total_score_for_question(review_type, question_id, participant_id, assignment_id, reviewee_id)
    # get the reviewer&#39;s team id for the currently answered question
    team_id = Team.joins([:teams_participants, teams_participants: [{ user: :participants }]]).where(&#39;participants.id = ? and teams.parent_id in (?)&#39;, participant_id, assignment_id).first
    team_id = team_id.id if team_id
    if review_type == &#39;TeammateReviewResponseMap&#39;
      answers_for_team_members = get_answers_for_teammatereview(team_id, question_id, participant_id, assignment_id, reviewee_id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Cake</code> |
          <strong>Line:</strong> 107
        </div>
        <div class="violation-reason">Method `get_answers_for_teammatereview` manipulates external state 7 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_answers_for_teammatereview(team_id, question_id, participant_id, assignment_id, reviewee_id)
    # get the reviewer&#39;s team members for the currently answered question
    team_members = Participant.joins(user: :teams_participants).where(&#39;teams_participants.team_id in (?) and participants.parent_id in (?)&#39;, team_id, assignment_id).ids
    # get the reviewer&#39;s ratings for his team members
    Answer.joins([{ response: :response_map }, :question]).where(&quot;response_maps.reviewee_id in (?) and response_maps.reviewed_object_id = (?)
      and answer is not null and response_maps.reviewer_id in (?) and answers.question_id in (?) and response_maps.reviewee_id not in (?)&quot;, team_members, assignment_id, participant_id, question_id, reviewee_id).to_a</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Cake</code> |
          <strong>Line:</strong> 116
        </div>
        <div class="violation-reason">Method `calculate_total_score` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def calculate_total_score(question_answers)
    question_score = 0.0
    question_answers.each do |question_answer|
      # calculate score per question
      unless question_answer.answer.nil?
        question_score += question_answer.answer</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/course_team.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CourseTeam</code> |
          <strong>Line:</strong> 70
        </div>
        <div class="violation-reason">Method `add_member` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def add_member(user, _id = nil)
    raise &quot;The user \&quot;#{user.name}\&quot; is already a member of the team, \&quot;#{name}\&quot;&quot; if user?(user)

    t_user = TeamsParticipant.create(user_id: user.id, team_id: id)
    parent = TeamNode.find_by(node_object_id: id)
    TeamUserNode.create(parent_id: parent.id, node_object_id: t_user.id)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/invitation.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+12</span>
          <span style="color: var(--accent-red)">-12</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Invitation</code> |
          <strong>Line:</strong> 20
        </div>
        <div class="violation-reason">Method `remove_users_sent_invites_for_assignment` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.remove_users_sent_invites_for_assignment(user_id, assignment_id)
    invites = Invitation.where(&#39;from_id = ? and assignment_id = ?&#39;, user_id, assignment_id)
    invites.each(&amp;:destroy)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Invitation</code> |
          <strong>Line:</strong> 26
        </div>
        <div class="violation-reason">Method `update_users_topic_after_invite_accept` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.update_users_topic_after_invite_accept(invitee_user_id, invited_user_id, assignment_id)
    new_team_id = TeamsParticipant.team_id(assignment_id, invitee_user_id)
    # check the invited_user_id have ever join other team in this assignment before
    # if so, update the original record; else create a new record
    original_team_id = TeamsParticipant.team_id(assignment_id, invited_user_id)
    if original_team_id</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-medium">
            75%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Invitation</code> |
          <strong>Line:</strong> 45
        </div>
        <div class="violation-reason">Method `accept_invitation` manipulates external state 2 times vs 1 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.accept_invitation(team_id, inviter_user_id, invited_user_id, assignment_id)
    # if you are on a team and you accept another invitation and if your old team does not have any members, delete the entry for the team
    if TeamsParticipant.team_empty?(team_id) &amp;&amp; (team_id != &#39;0&#39;)
      assignment_id = AssignmentTeam.find(team_id).assignment.id
      # Release topics for the team has selected by the invited users empty team
      SignedUpTeam.release_topics_selected_by_team_for_assignment(team_id, assignment_id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Invitation</code> |
          <strong>Line:</strong> 68
        </div>
        <div class="violation-reason">Method `is_invited?` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.is_invited?(invitee_user_id, invited_user_id, assignment_id)
    sent_invitation = Invitation.where(&#39;from_id = ? and to_id = ? and assignment_id = ? and reply_status = &quot;W&quot;&#39;,
                                       invitee_user_id, invited_user_id, assignment_id)
    sent_invitation.empty?
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/mentor_management.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentorManagement</code> |
          <strong>Line:</strong> 43
        </div>
        <div class="violation-reason">Method `assign_mentor` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.assign_mentor(assignment_id, team_id)
    assignment = Assignment.find(assignment_id)
    team = Team.find(team_id)

    # RuboCop &#39;use guard clause instead of nested conditionals&#39;
    # return if assignments can&#39;t accept mentors</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentorManagement</code> |
          <strong>Line:</strong> 43
        </div>
        <div class="violation-reason">Method `assign_mentor` manipulates external state 8 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.assign_mentor(assignment_id, team_id)
    assignment = Assignment.find(assignment_id)
    team = Team.find(team_id)

    # RuboCop &#39;use guard clause instead of nested conditionals&#39;
    # return if assignments can&#39;t accept mentors</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentorManagement</code> |
          <strong>Line:</strong> 124
        </div>
        <div class="violation-reason">Method `zip_mentors_with_team_count` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.zip_mentors_with_team_count(assignment_id)
    mentor_ids = mentors_for_assignment(assignment_id).pluck(:user_id)
    return [] if mentor_ids.empty?
    team_counts = {}
    mentor_ids.each { |id| team_counts[id] = 0 }
    #E2351 removed (:team_id) after .count to fix balancing algorithm</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/mentored_team.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Dependency Inversion Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentoredTeam</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Directly instantiates 1 concrete collaborators; prefer dependency injection.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class MentoredTeam &lt; AssignmentTeam
    # Class created during refactoring of E2351
    # Overridden method to include the MentorManagement workflow
    def add_member(user, _assignment_id = nil)
        raise &quot;The user #{user.name} is already a member of the team #{name}&quot; if user?(user)
    
        can_add_member = false
        unless full?</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentoredTeam</code> |
          <strong>Line:</strong> 22
        </div>
        <div class="violation-reason">Method `import_team_members` contains a call chain of length 4.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def import_team_members(row_hash)
        row_hash[:teammembers].each_with_index do |teammate, _index|
          if teammate.to_s.strip.empty?
            next
          end
          user = User.find_by(name: teammate.to_s)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentoredTeam</code> |
          <strong>Line:</strong> 4
        </div>
        <div class="violation-reason">Method `add_member` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def add_member(user, _assignment_id = nil)
        raise &quot;The user #{user.name} is already a member of the team #{name}&quot; if user?(user)
    
        can_add_member = false
        unless full?
          can_add_member = true</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>MentoredTeam</code> |
          <strong>Line:</strong> 22
        </div>
        <div class="violation-reason">Method `import_team_members` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def import_team_members(row_hash)
        row_hash[:teammembers].each_with_index do |teammate, _index|
          if teammate.to_s.strip.empty?
            next
          end
          user = User.find_by(name: teammate.to_s)</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/participant.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Participant</code> |
          <strong>Line:</strong> 58
        </div>
        <div class="violation-reason">Method `force_delete` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def force_delete(maps)
    maps &amp;&amp; maps.each(&amp;:destroy)
    if team &amp;&amp; (team.teams_participants.length == 1)
      team.delete
    elsif team
      team.teams_participants.each { |teams_participant| teams_participant.destroy if teams_participant.user_id == id }</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Participant</code> |
          <strong>Line:</strong> 68
        </div>
        <div class="violation-reason">Method `topic_name` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def topic_name
    if topic.nil? || topic.topic_name.empty?
      &#39;&lt;center&gt;&amp;#8212;&lt;/center&gt;&#39; # em dash
    else
      topic.topic_name
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Participant</code> |
          <strong>Line:</strong> 50
        </div>
        <div class="violation-reason">Method `delete` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete(force = nil)
    maps = ResponseMap.where(&#39;reviewee_id = ? or reviewer_id = ?&#39;, id, id)

    raise &#39;Associations exist for this participant.&#39; unless force || (maps.blank? &amp;&amp; team.nil?)

    force_delete(maps)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Participant</code> |
          <strong>Line:</strong> 58
        </div>
        <div class="violation-reason">Method `force_delete` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def force_delete(maps)
    maps &amp;&amp; maps.each(&amp;:destroy)
    if team &amp;&amp; (team.teams_participants.length == 1)
      team.delete
    elsif team
      team.teams_participants.each { |teams_participant| teams_participant.destroy if teams_participant.user_id == id }</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Participant</code> |
          <strong>Line:</strong> 68
        </div>
        <div class="violation-reason">Method `topic_name` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def topic_name
    if topic.nil? || topic.topic_name.empty?
      &#39;&lt;center&gt;&amp;#8212;&lt;/center&gt;&#39; # em dash
    else
      topic.topic_name
    end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/review_response_map.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/sign_up_sheet.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheet</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 6 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class SignUpSheet &lt; ApplicationRecord
  # Team lazy initialization method [zhewei, 06/27/2015]
  def self.signup_team(assignment_id, user_id, topic_id = nil)
    # Find the team ID for the given assignment and user
    team_id = Team.find_team_participants(assignment_id, user_id)&amp;.first&amp;.t_id
    # If the team doesn&#39;t exist, create a new team and assign the team ID
    if team_id.nil?
      team = AssignmentTeam.create_team_with_users(assignment_id, [user_id])</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheet</code> |
          <strong>Line:</strong> 3
        </div>
        <div class="violation-reason">Method `signup_team` manipulates external state 5 times vs 3 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.signup_team(assignment_id, user_id, topic_id = nil)
    # Find the team ID for the given assignment and user
    team_id = Team.find_team_participants(assignment_id, user_id)&amp;.first&amp;.t_id
    # If the team doesn&#39;t exist, create a new team and assign the team ID
    if team_id.nil?
      team = AssignmentTeam.create_team_with_users(assignment_id, [user_id])</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpSheet</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class SignUpSheet &lt; ApplicationRecord
  # Team lazy initialization method [zhewei, 06/27/2015]
  def self.signup_team(assignment_id, user_id, topic_id = nil)
    # Find the team ID for the given assignment and user
    team_id = Team.find_team_participants(assignment_id, user_id)&amp;.first&amp;.t_id
    # If the team doesn&#39;t exist, create a new team and assign the team ID
    if team_id.nil?
      team = AssignmentTeam.create_team_with_users(assignment_id, [user_id])</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/sign_up_topic.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignUpTopic</code> |
          <strong>Line:</strong> 20
        </div>
        <div class="violation-reason">Method `import` manipulates external state 7 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.import(row_hash, session, _id = nil)
    if row_hash.length &lt; 3
      raise ArgumentError, &#39;The CSV File expects the format: Topic identifier, Topic name, Max choosers, Topic Category (optional), Topic Description (Optional), Topic Link (optional).&#39;
    end

    topic = SignUpTopic.where(topic_name: row_hash[:topic_name], assignment_id: session[:assignment_id]).first</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/signed_up_team.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 76
        </div>
        <div class="violation-reason">Method `topic_id_by_team_id` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.topic_id_by_team_id(team_id)
    signed_up_teams = SignedUpTeam.where(team_id: team_id, is_waitlisted: 0)
    if signed_up_teams.blank?
      nil
    else
      signed_up_teams.first.topic_id</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 9
        </div>
        <div class="violation-reason">Method `find_team_participants` manipulates external state 30 times vs 4 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.find_team_participants(assignment_id, ip_address = nil)
    @participants = SignedUpTeam.joins(&#39;INNER JOIN sign_up_topics ON signed_up_teams.topic_id = sign_up_topics.id&#39;)
                                .select(&#39;signed_up_teams.id as id, sign_up_topics.id as topic_id, sign_up_topics.topic_name as name,
                                  sign_up_topics.topic_name as team_name_placeholder, sign_up_topics.topic_name as user_name_placeholder,
                                  signed_up_teams.is_waitlisted as is_waitlisted, signed_up_teams.team_id as team_id&#39;)
                                .where(&#39;sign_up_topics.assignment_id = ?&#39;, assignment_id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 41
        </div>
        <div class="violation-reason">Method `find_team_participants` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.find_team_participants(assignment_id, user_id)
    TeamsParticipant.joins(&#39;INNER JOIN teams ON teams_participants.team_id = teams.id&#39;)
             .select(&#39;teams.id as t_id&#39;)
             .where(&#39;teams.parent_id = ? and teams_participants.user_id = ?&#39;, assignment_id, user_id)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 47
        </div>
        <div class="violation-reason">Method `find_user_signup_topics` manipulates external state 9 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.find_user_signup_topics(assignment_id, team_id)
    SignedUpTeam.joins(&#39;INNER JOIN sign_up_topics ON signed_up_teams.topic_id = sign_up_topics.id&#39;)
                .select(&#39;sign_up_topics.id as topic_id, sign_up_topics.topic_name as topic_name, signed_up_teams.is_waitlisted as is_waitlisted,
                  signed_up_teams.preference_priority_number as preference_priority_number&#39;)
                .where(&#39;sign_up_topics.assignment_id = ? and signed_up_teams.team_id = ?&#39;, assignment_id, team_id)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 55
        </div>
        <div class="violation-reason">Method `release_topics_selected_by_team_for_assignment` manipulates external state 9 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.release_topics_selected_by_team_for_assignment(team_id, assignment_id)
    old_teams_signups = SignedUpTeam.where(team_id: team_id)

    # If the team has signed up for the topic and they are on the waitlist then remove that team from the waitlist.
    unless old_teams_signups.nil?
      old_teams_signups.each do |old_teams_signup|</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 76
        </div>
        <div class="violation-reason">Method `topic_id_by_team_id` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.topic_id_by_team_id(team_id)
    signed_up_teams = SignedUpTeam.where(team_id: team_id, is_waitlisted: 0)
    if signed_up_teams.blank?
      nil
    else
      signed_up_teams.first.topic_id</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>SignedUpTeam</code> |
          <strong>Line:</strong> 86
        </div>
        <div class="violation-reason">Method `drop_signup_record` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.drop_signup_record(topic_id,team_id)
    # Fetching record for a given topic and team.
    signup_record = SignedUpTeam.find_by(topic_id: topic_id, team_id: team_id)
    # If the signup_record in not nil destroy it.
    signup_record.destroy unless signup_record.nil?
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/tag_prompt_deployment.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TagPromptDeployment</code> |
          <strong>Line:</strong> 13
        </div>
        <div class="violation-reason">Method `get_number_of_taggable_answers` manipulates external state 10 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def get_number_of_taggable_answers(user_id)
    team = Team.joins(:teams_participants).where(team_participants: { parent_id: assignment_id }, user_id: user_id)
    responses = Response.joins(:response_maps).where(response_maps: { reviewed_object_id: assignment.id, reviewee_id: team.id })
    questions = Question.where(questionnaire_id: questionnaire.id, type: question_type)

    unless responses.empty? || questions.empty?</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/team.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+19</span>
          <span style="color: var(--accent-red)">-19</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 27 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class Team &lt; ApplicationRecord
  has_many :teams_participants, dependent: :destroy
  has_many :users, through: :teams_participants
  has_many :join_team_requests, dependent: :destroy
  has_one :team_node, foreign_key: :node_object_id, dependent: :destroy
  has_many :signed_up_teams, dependent: :destroy
  has_many :bids, dependent: :destroy
  has_paper_trail</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class directly instantiates 2 collaborators.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class Team &lt; ApplicationRecord
  has_many :teams_participants, dependent: :destroy
  has_many :users, through: :teams_participants
  has_many :join_team_requests, dependent: :destroy
  has_one :team_node, foreign_key: :node_object_id, dependent: :destroy
  has_many :signed_up_teams, dependent: :destroy
  has_many :bids, dependent: :destroy
  has_paper_trail</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Open/Closed Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Uses 4 type-checking conditional(s); prefer polymorphism.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class Team &lt; ApplicationRecord
  has_many :teams_participants, dependent: :destroy
  has_many :users, through: :teams_participants
  has_many :join_team_requests, dependent: :destroy
  has_one :team_node, foreign_key: :node_object_id, dependent: :destroy
  has_many :signed_up_teams, dependent: :destroy
  has_many :bids, dependent: :destroy
  has_paper_trail</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Dependency Inversion Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Directly instantiates 2 concrete collaborators; prefer dependency injection.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class Team &lt; ApplicationRecord
  has_many :teams_participants, dependent: :destroy
  has_many :users, through: :teams_participants
  has_many :join_team_requests, dependent: :destroy
  has_one :team_node, foreign_key: :node_object_id, dependent: :destroy
  has_many :signed_up_teams, dependent: :destroy
  has_many :bids, dependent: :destroy
  has_paper_trail</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 128
        </div>
        <div class="violation-reason">Method `randomize_all_by_parent` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.randomize_all_by_parent(parent, team_type, min_team_size)
    participants = Participant.where(parent_id: parent.id, type: parent.class.to_s + &#39;Participant&#39;, can_mentor: [false, nil])
    participants = participants.sort { rand(-1..1) }
    users = participants.map { |p| User.find(p.user_id) }.to_a
    # find teams still need team members and users who are not in any team
    teams = Team.where(parent_id: parent.id, type: parent.class.to_s + &#39;Team&#39;).to_a</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 150
        </div>
        <div class="violation-reason">Method `create_team_from_single_users` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.create_team_from_single_users(min_team_size, parent, team_type, users)
    num_of_teams = users.length.fdiv(min_team_size).ceil
    next_team_member_index = 0
    (1..num_of_teams).to_a.each do |i|
      team = Object.const_get(team_type + &#39;Team&#39;).create(name: &#39;Team_&#39; + i.to_s, parent_id: parent.id)
      TeamNode.create(parent_id: parent.id, node_object_id: team.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 182
        </div>
        <div class="violation-reason">Method `generate_team_name` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.generate_team_name(_team_name_prefix = &#39;&#39;)
    last_team = Team.where(&#39;name LIKE ?&#39;, &quot;#{_team_name_prefix} Team_%&quot;)
                  .order(&quot;CAST(SUBSTRING(name, LENGTH(&#39;#{_team_name_prefix} Team_&#39;) + 1) AS UNSIGNED) DESC&quot;)
                  .first
    counter = last_team ? last_team.name.scan(/\d+/).first.to_i + 1 : 1
    team_name = &quot;#{_team_name_prefix} Team_#{counter}&quot;</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 27
        </div>
        <div class="violation-reason">Method `copy_content` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.copy_content(source, destination)
    source.each do |each_element|
      each_element.copy(destination.id)
    end
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 80
        </div>
        <div class="violation-reason">Method `add_member` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def add_member(user, _assignment_id = nil)
    raise &quot;The user #{user.name} is already a member of the team #{name}&quot; if user?(user)

    can_add_member = false
    unless full?
      can_add_member = true</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 96
        </div>
        <div class="violation-reason">Method `size` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.size(team_id)
    #TeamsParticipant.where(team_id: team_id).count
    count = 0
    members = TeamsParticipant.where(team_id: team_id)
    members.each do |member|
      member_name = member.name</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 110
        </div>
        <div class="violation-reason">Method `copy_members` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def copy_members(new_team)
    members = TeamsParticipant.where(team_id: id)
    members.each do |member|
      t_user = TeamsParticipant.create(team_id: new_team.id, user_id: member.user_id)
      parent = Object.const_get(parent_model).find(parent_id)
      TeamUserNode.create(parent_id: parent.id, node_object_id: t_user.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 120
        </div>
        <div class="violation-reason">Method `check_for_existing` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.check_for_existing(parent, name, team_type)
    list = Object.const_get(team_type + &#39;Team&#39;).where(parent_id: parent.id, name: name)
    raise TeamExistsError, &quot;The team name #{name} is already in use.&quot; unless list.empty?
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 128
        </div>
        <div class="violation-reason">Method `randomize_all_by_parent` manipulates external state 19 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.randomize_all_by_parent(parent, team_type, min_team_size)
    participants = Participant.where(parent_id: parent.id, type: parent.class.to_s + &#39;Participant&#39;, can_mentor: [false, nil])
    participants = participants.sort { rand(-1..1) }
    users = participants.map { |p| User.find(p.user_id) }.to_a
    # find teams still need team members and users who are not in any team
    teams = Team.where(parent_id: parent.id, type: parent.class.to_s + &#39;Team&#39;).to_a</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 150
        </div>
        <div class="violation-reason">Method `create_team_from_single_users` manipulates external state 11 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.create_team_from_single_users(min_team_size, parent, team_type, users)
    num_of_teams = users.length.fdiv(min_team_size).ceil
    next_team_member_index = 0
    (1..num_of_teams).to_a.each do |i|
      team = Object.const_get(team_type + &#39;Team&#39;).create(name: &#39;Team_&#39; + i.to_s, parent_id: parent.id)
      TeamNode.create(parent_id: parent.id, node_object_id: team.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 167
        </div>
        <div class="violation-reason">Method `assign_single_users_to_teams` manipulates external state 10 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.assign_single_users_to_teams(min_team_size, parent, teams, users)
    teams.each do |team|
      curr_team_size = Team.size(team.id)
      member_num_difference = min_team_size - curr_team_size
      while member_num_difference &gt; 0
        team.add_member(users.first, parent.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 182
        </div>
        <div class="violation-reason">Method `generate_team_name` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.generate_team_name(_team_name_prefix = &#39;&#39;)
    last_team = Team.where(&#39;name LIKE ?&#39;, &quot;#{_team_name_prefix} Team_%&quot;)
                  .order(&quot;CAST(SUBSTRING(name, LENGTH(&#39;#{_team_name_prefix} Team_&#39;) + 1) AS UNSIGNED) DESC&quot;)
                  .first
    counter = last_team ? last_team.name.scan(/\d+/).first.to_i + 1 : 1
    team_name = &quot;#{_team_name_prefix} Team_#{counter}&quot;</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 192
        </div>
        <div class="violation-reason">Method `import_team_members` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def import_team_members(row_hash)
    row_hash[:teammembers].each_with_index do |teammate, _index|
      user = User.find_by(name: teammate.to_s)
      if user.nil?
        raise ImportError, &quot;The user &#39;#{teammate}&#39; was not found. &lt;a href=&#39;/users/new&#39;&gt;Create&lt;/a&gt; this user?&quot;
      else</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 204
        </div>
        <div class="violation-reason">Method `import` manipulates external state 7 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.import(row_hash, id, options, teamtype)
    raise ArgumentError, &#39;Not enough fields on this line.&#39; if row_hash.empty? || (row_hash[:teammembers].empty? &amp;&amp; (options[:has_teamname] == &#39;true_first&#39; || options[:has_teamname] == &#39;true_last&#39;)) || (row_hash[:teammembers].empty? &amp;&amp; (options[:has_teamname] == &#39;true_first&#39; || options[:has_teamname] == &#39;true_last&#39;))
    if options[:has_teamname] == &#39;true_first&#39; || options[:has_teamname] == &#39;true_last&#39;
      name = row_hash[:teamname].to_s
      team = where([&#39;name =? &amp;&amp; parent_id =?&#39;, name, id]).first
      team_exists = !team.nil?</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 228
        </div>
        <div class="violation-reason">Method `handle_duplicate` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.handle_duplicate(team, name, id, handle_dups, teamtype)
    return name if team.nil? # no duplicate
    return nil if handle_dups == &#39;ignore&#39; # ignore: do not create the new team

    if handle_dups == &#39;rename&#39; # rename: rename new team
      if teamtype.is_a?(CourseTeam)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 248
        </div>
        <div class="violation-reason">Method `export` manipulates external state 10 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.export(csv, parent_id, options, teamtype)
    if teamtype.is_a?(CourseTeam)
      teams = CourseTeam.where(parent_id: parent_id)
    elsif teamtype.is_a?(AssignmentTeam)
      teams = AssignmentTeam.where(parent_id: parent_id)
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 269
        </div>
        <div class="violation-reason">Method `create_team_and_node` manipulates external state 4 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.create_team_and_node(id)
    parent = parent_model id # current_task will be either a course object or an assignment object.
    team_name = Team.generate_team_name(parent.name)
    team = create(name: team_name, parent_id: id)
    # new teamnode will have current_task.id as parent_id and team_id as node_object_id.
    TeamNode.create(parent_id: id, node_object_id: team.id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 294
        </div>
        <div class="violation-reason">Method `create_team_with_users` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.create_team_with_users(parent_id, user_ids)
    team = create_team_and_node(parent_id)

    user_ids.each do |user_id|
      remove_user_from_previous_team(parent_id, user_id)</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 307
        </div>
        <div class="violation-reason">Method `remove_user_from_previous_team` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.remove_user_from_previous_team(parent_id, user_id)
    team_participant = TeamsParticipant.where(user_id: user_id).find { |team_participant_obj| team_participant_obj.team.parent_id == parent_id }
    begin
      team_participant.destroy
    rescue StandardError
      nil</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 316
        </div>
        <div class="violation-reason">Method `find_team_participants` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.find_team_participants(assignment_id, user_id)
    TeamsParticipant.joins(&#39;INNER JOIN teams ON teams_participants.team_id = teams.id&#39;)
             .select(&#39;teams.id as t_id&#39;)
             .where(&#39;teams.parent_id = ? and teams_participants.user_id = ?&#39;, assignment_id, user_id)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>Team</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class Team &lt; ApplicationRecord
  has_many :teams_participants, dependent: :destroy
  has_many :users, through: :teams_participants
  has_many :join_team_requests, dependent: :destroy
  has_one :team_node, foreign_key: :node_object_id, dependent: :destroy
  has_many :signed_up_teams, dependent: :destroy
  has_many :bids, dependent: :destroy
  has_paper_trail</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/team_user_node.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamUserNode</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 4 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamUserNode &lt; Node
  belongs_to :node_object, class_name: &#39;TeamsParticipant&#39;
  # attr_accessible :parent_id, :node_object_id  # unnecessary protected attributes

  def self.table
    &#39;teams_participants&#39;
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamUserNode</code> |
          <strong>Line:</strong> 13
        </div>
        <div class="violation-reason">Method `get` manipulates external state 6 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.get(parent_id)
    nodes = Node.joins(&#39;INNER JOIN teams_participants ON nodes.node_object_id = teams_participants.id&#39;)
                .select(&#39;nodes.*&#39;)
                .where(&quot;nodes.type = &#39;TeamUserNode&#39;&quot;)
    nodes.where(&#39;teams_participants.team_id = ?&#39;, parent_id) if parent_id
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamUserNode</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamUserNode &lt; Node
  belongs_to :node_object, class_name: &#39;TeamsParticipant&#39;
  # attr_accessible :parent_id, :node_object_id  # unnecessary protected attributes

  def self.table
    &#39;teams_participants&#39;
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/teams_participant.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+72</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Single Responsibility Principle</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Class exposes 8 methods (limit: 4).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsParticipant &lt; ApplicationRecord
  belongs_to :team
  belongs_to :participant

  # paper_trail, node, etc
  has_one    :team_participant_node,
             foreign_key: &#39;node_object_id&#39;,
             dependent:   :destroy</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 25
        </div>
        <div class="violation-reason">Method `delete` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete
    team_participant_node&amp;.destroy
    t = team
    destroy
    t.destroy if t.teams_participants.empty?
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 69
        </div>
        <div class="violation-reason">Method `team_id` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.team_id(assignment_id, user_id)
    each_for(user_id).find { |tp| tp.team.parent_id == assignment_id }&amp;.team_id
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 25
        </div>
        <div class="violation-reason">Method `delete` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def delete
    team_participant_node&amp;.destroy
    t = team
    destroy
    t.destroy if t.teams_participants.empty?
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 33
        </div>
        <div class="violation-reason">Method `remove_team` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.remove_team(user_id, team_id)
    jp = joins(participant: :user)
           .where(&#39;participants.user_id = ? AND team_id = ?&#39;, user_id, team_id)
           .first
    jp&amp;.destroy
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 51
        </div>
        <div class="violation-reason">Method `add_member_to_invited_team` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.add_member_to_invited_team(invitee_user_id, invited_user_id, assignment_id)
    success = false
    each_for(invitee_user_id) do |tp|
      next unless (asg_team = AssignmentTeam.find_by(id: tp.team_id, parent_id: assignment_id))
      invited_participant = Participant.find_by(user_id: invited_user_id, parent_id: assignment_id)
      success = asg_team.add_member(invited_participant) if invited_participant</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 62
        </div>
        <div class="violation-reason">Method `each_for` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.each_for(user_id, &amp;block)
    joins(participant: :user)
      .where(&#39;participants.user_id = ?&#39;, user_id)
      .each(&amp;block)
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 69
        </div>
        <div class="violation-reason">Method `team_id` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.team_id(assignment_id, user_id)
    each_for(user_id).find { |tp| tp.team.parent_id == assignment_id }&amp;.team_id
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Encapsulation</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsParticipant</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Has 100.0% public methods (limit: 60.0%).</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsParticipant &lt; ApplicationRecord
  belongs_to :team
  belongs_to :participant

  # paper_trail, node, etc
  has_one    :team_participant_node,
             foreign_key: &#39;node_object_id&#39;,
             dependent:   :destroy</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/teams_user.rb</span>
        <span>
          <span class="badge badge-removed">removed</span>
          
          <span style="color: var(--accent-green)">+0</span>
          <span style="color: var(--accent-red)">-76</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">app/models/user.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">config/routes.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+114</span>
          <span style="color: var(--accent-red)">-116</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/002_initialize_custom.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/019_create_teams_users.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+7</span>
          <span style="color: var(--accent-red)">-7</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateTeamsUsers</code> |
          <strong>Line:</strong> 2
        </div>
        <div class="violation-reason">Method `up` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.up
    create_table &#39;teams_participants&#39;, force: true do |t|
      t.column &#39;team_id&#39;, :integer
      t.column &#39;user_id&#39;, :integer
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateTeamsUsers</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class CreateTeamsUsers &lt; ActiveRecord::Migration[4.2]
  def self.up
    create_table &#39;teams_participants&#39;, force: true do |t|
      t.column &#39;team_id&#39;, :integer
      t.column &#39;user_id&#39;, :integer
    end

    add_index &#39;teams_participants&#39;, [&#39;team_id&#39;], name: &#39;fk_users_teams&#39;</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/066_create_team_user_nodes.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateTeamUserNodes</code> |
          <strong>Line:</strong> 2
        </div>
        <div class="violation-reason">Method `up` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.up
    begin
      remove_column :teams_participants, :assignment_id
    rescue StandardError
    end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateTeamUserNodes</code> |
          <strong>Line:</strong> 17
        </div>
        <div class="violation-reason">Method `down` manipulates external state 2 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.down
    teamsusers = TeamsUser.all
    teamsusers.each(&amp;:destroy)

    add_column :teams_participants, :assignment_id, :integer
  end</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateTeamUserNodes</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class CreateTeamUserNodes &lt; ActiveRecord::Migration[4.2]
  def self.up
    begin
      remove_column :teams_participants, :assignment_id
    rescue StandardError
    end

    teamsusers = TeamsUser.all</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20121018001330_change_teams_users_to_teams_participants.rb</span>
        <span>
          <span class="badge badge-removed">removed</span>
          
          <span style="color: var(--accent-green)">+0</span>
          <span style="color: var(--accent-red)">-8</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20131103014327_create_participant_score_views.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateParticipantScoreViews</code> |
          <strong>Line:</strong> 2
        </div>
        <div class="violation-reason">Method `up` manipulates external state 20 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.up
    execute &lt;&lt;-SQL
      CREATE VIEW participant_score_views AS SELECT r.id response_id,s.answer,q.weight,qs.name questionaire_type,qs.max_question_score,t.id as team_id,user_id as participant_id , t.parent_id as assignment_id
 FROM answers s ,responses r, response_maps rm, questions q, questionnaires qs , teams_participants tu , teams t
 WHERE  rm.id = r.map_id AND r.id=s.response_id AND q.id = s.question_id AND qs.id = q.questionnaire_id    AND tu.team_id = rm.reviewee_id   AND tu.team_id = t.id
    SQL</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>CreateParticipantScoreViews</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class CreateParticipantScoreViews &lt; ActiveRecord::Migration[4.2]
  def self.up
    execute &lt;&lt;-SQL
      CREATE VIEW participant_score_views AS SELECT r.id response_id,s.answer,q.weight,qs.name questionaire_type,qs.max_question_score,t.id as team_id,user_id as participant_id , t.parent_id as assignment_id
 FROM answers s ,responses r, response_maps rm, questions q, questionnaires qs , teams_participants tu , teams t
 WHERE  rm.id = r.map_id AND r.id=s.response_id AND q.id = s.question_id AND qs.id = q.questionnaire_id    AND tu.team_id = rm.reviewee_id   AND tu.team_id = t.id
    SQL
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20141111010259_add_index_to_response_maps.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AddIndexToResponseMaps</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class AddIndexToResponseMaps &lt; ActiveRecord::Migration[4.2]
  def self.up
    # add_index :response_maps, :reviewee_id
    # add_index :response_maps, :reviewer_id
    # add_index :response_maps, :reviewed_object_id

    # add_index :teams_participants, :user_id</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20141204022200_add_team_index_to_teams_users.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AddTeamIndexToTeamsUsers</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class AddTeamIndexToTeamsUsers &lt; ActiveRecord::Migration[4.2]
   def self.up
      #add_index :teams_participants, :team_id
   end

  def self.down
    # remove_index :teams_participants, :team_id
  end</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20150527105416_convert_all_individual_assignments_to_one_member_team_assignments.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20211110161054_add_duty_id_to_teams_users.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20220405141744_add_pair_programming_status_to_teams_users.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20230415194444_add_participant_id_and_populate.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Law of Demeter</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            80%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AddParticipantIdAndPopulate</code> |
          <strong>Line:</strong> 3
        </div>
        <div class="violation-reason">Method `up` contains a call chain of length 3.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def up
    add_column :teams_participants, :participant_id, :integer, limit: 4, index: true
    add_foreign_key :teams_participants, :participants
    # firstly, fetch all TeamsUser rows
    teams_participants = TeamsUser.all
    # for each TeamsUser row</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AddParticipantIdAndPopulate</code> |
          <strong>Line:</strong> 3
        </div>
        <div class="violation-reason">Method `up` manipulates external state 9 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def up
    add_column :teams_participants, :participant_id, :integer, limit: 4, index: true
    add_foreign_key :teams_participants, :participants
    # firstly, fetch all TeamsUser rows
    teams_participants = TeamsUser.all
    # for each TeamsUser row</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20240319000001_rename_teams_users_to_teams_participants.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+15</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20240320000002_add_participant_id_to_teams_participants.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+28</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            95%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>AddParticipantIdToTeamsParticipants</code> |
          <strong>Line:</strong> 5
        </div>
        <div class="violation-reason">Method `up` manipulates external state 5 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def up
      unless column_exists?(:teams_participants, :participant_id)
        add_column :teams_participants, :participant_id, :integer
        add_index  :teams_participants, :participant_id, algorithm: :concurrently
  
        # backâ€fill: for each row, find the Participant whose user_id = old user_id</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20240320000003_remove_user_id_from_teams_participants.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+18</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate/20240320000004_add_fks_to_teams_participants.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+8</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/migrate_save/020_teams_users.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Information Expert</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            85%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsUsers</code> |
          <strong>Line:</strong> 2
        </div>
        <div class="violation-reason">Method `up` manipulates external state 3 times vs 0 local accesses.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">def self.up
    create_table :teams_participants do |t| # maps users to teams; in rare cases, a single individual is on &gt; 1 team for an assgt.
      t.column :team_id, :integer
      t.column :user_id, :integer
    end
    execute &quot;alter table teams_participants</div>
        
      </div>
      
      
      <div class="violation">
        <div class="violation-header">
          <span>
            <span class="violation-type">Overuse of Class Methods</span>
            
            <span class="changed-indicator">Changed Code</span>
            
          </span>
          <span class="confidence confidence-high">
            90%
          </span>
        </div>
        <div class="violation-meta">
          <strong>Class:</strong> <code>TeamsUsers</code> |
          <strong>Line:</strong> 1
        </div>
        <div class="violation-reason">Defines 2 class methods and 0 instance method(s); consider instance state.</div>
        
        <div class="suggestion"><strong>ðŸ’¡ Suggestion:</strong> Extract collaborators and follow the cited principle.</div>
        
        
        <div class="code-block">class TeamsUsers &lt; ActiveRecord::Migration[4.2]
  def self.up
    create_table :teams_participants do |t| # maps users to teams; in rare cases, a single individual is on &gt; 1 team for an assgt.
      t.column :team_id, :integer
      t.column :user_id, :integer
    end
    execute &quot;alter table teams_participants
             add constraint fk_users_teams</div>
        
      </div>
      
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">db/schema.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+10</span>
          <span style="color: var(--accent-red)">-11</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/advertise_for_partner_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/invitations_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/lottery_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+12</span>
          <span style="color: var(--accent-red)">-12</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/pair_programming_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/popup_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/review_mapping_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/sign_up_sheet_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/student_teams_controller_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/teams_participants_controller_spec.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+179</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/controllers/teams_users_controller_spec.rb</span>
        <span>
          <span class="badge badge-removed">removed</span>
          
          <span style="color: var(--accent-green)">+0</span>
          <span style="color: var(--accent-red)">-340</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/factories/factories.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+504</span>
          <span style="color: var(--accent-red)">-510</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/airbrake_exception_errors_feature_tests_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/assignment_team_member_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/bookmark_review_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/instructor_do_review_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/list_teams_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/peer_review_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/quiz_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/review_mapping_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/teams_as_reviewers_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/features/view_team_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/helpers/review_mapping_helper_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/assignment_participant_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/assignment_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/assignment_team_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/cake_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+4</span>
          <span style="color: var(--accent-red)">-4</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/course_team_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+3</span>
          <span style="color: var(--accent-red)">-3</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/duty_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/invitation_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+19</span>
          <span style="color: var(--accent-red)">-19</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/mentor_management_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/participant_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+6</span>
          <span style="color: var(--accent-red)">-6</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/review_response_map_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+2</span>
          <span style="color: var(--accent-red)">-2</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/student_task_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+5</span>
          <span style="color: var(--accent-red)">-5</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/tag_prompt_deployment_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+9</span>
          <span style="color: var(--accent-red)">-9</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/team_spec.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+8</span>
          <span style="color: var(--accent-red)">-8</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/models/teams_participant_spec.rb</span>
        <span>
          <span class="badge badge-added">added</span>
          
          <span style="color: var(--accent-green)">+132</span>
          <span style="color: var(--accent-red)">-0</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    <div class="file-section">
      <div class="file-header">
        <span class="file-name">spec/support/teams_shared.rb</span>
        <span>
          <span class="badge badge-modified">modified</span>
          
          <span style="color: var(--accent-green)">+1</span>
          <span style="color: var(--accent-red)">-1</span>
          
        </span>
      </div>
      
      
      <div class="no-violations">âœ“ No design principle violations detected</div>
      
    </div>
    
    
    <footer>
      Report generated at 2026-01-22T12:57:27-05:00
    </footer>
  </div>
</body>
</html>
